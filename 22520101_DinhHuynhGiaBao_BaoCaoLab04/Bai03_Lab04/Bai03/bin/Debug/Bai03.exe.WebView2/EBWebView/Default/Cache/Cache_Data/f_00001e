(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[9381],{59381:function(e,o,r){"use strict";r.d(o,{Z:function(){return UserProvider},a:function(){return useUser}});var t=r(57437),s=r(2265),i=r(26539),n=r(83838);let a={error:{code:"0"},data:{},user:{email:"",fname:"",lname:"",fullname:"",plan:"free",noUpsell:!1},userID:void 0,accessToken:void 0,sessionIsPresent:void 0,sessionSoftLookupUtms:0,sessionProcessedUtms:0,isLoggedIn:void 0,isPageReadyToLoad:!1,update:()=>({}),isFreeUser:!1},c=(0,s.createContext)(a);function UserProvider(e){let{children:o}=e,r=(0,s.useRef)(a),d=(0,s.useRef)(null),[u,l]=(0,s.useState)(0),[g,f]=(0,s.useState)(0),[p,S]=(0,s.useState)(0),[h,v]=(0,s.useState)(!1),update=()=>{let e=(0,i.Si)();d.current=e;let o=e.data;if(!o.sessionIsPresent)return(0,i.Sg)({context:"Pathfinder -> UserProvider -> session soft lookup (update)",originUrl:location.href,reason:e.error}),e;let t=(0,i.Ju)(),s=r.current,a=!1;return(s.error.code!==e.error.code||s.userID!==o.id||s.accessToken!==o.accessToken)&&(a=!0),s.error=e.error,s.data=e.data,s.user={email:o.email,fname:o.firstName,lname:o.lastName,fullname:o.fullName,plan:o.subscriptionPlan,noUpsell:o.noUpsell},s.userID=o.id,s.accessToken=o.accessToken,s.sessionIsPresent=o.sessionIsPresent,a&&((0,n.o7)("Pathfinder -> UserProvider -> session soft lookup (update) -> sessionHasChanged -> utms: ",t),s.sessionSoftLookupUtms=t,l(t)),S(t),(0,n.o7)("Pathfinder -> UserProvider -> session soft lookup (update) -> utms: ",t),e};(0,s.useEffect)(()=>{if(null===d.current){let e=(0,i.Si)();d.current=e;let o=e.data;if(!o.sessionIsPresent)return(0,i.Sg)({context:"Pathfinder -> UserProvider -> session soft lookup",originUrl:location.href,reason:e.error});let t=(0,i.Ju)();r.current={error:e.error,data:e.data,user:{email:o.email,fname:o.firstName,lname:o.lastName,fullname:o.fullName,plan:o.subscriptionPlan,noUpsell:o.noUpsell},userID:o.id,accessToken:o.accessToken,sessionIsPresent:o.sessionIsPresent,sessionSoftLookupUtms:t,sessionProcessedUtms:0,isLoggedIn:void 0,update,isFreeUser:"free"===o.subscriptionPlan},l(t),S(t),(0,n.o7)("Pathfinder -> UserProvider -> session soft lookup -> utms: ",t)}},[]),(0,s.useEffect)(()=>{if(u>0){let _processUserSession=async()=>{var e;let o=await (0,i.Ic)({context:"Pathfinder -> UserProvider -> process user session",preferDethrottleCache:!0,handleRedirectionLogic:!0,sessionVerificationRes:null===(e=d.current)||void 0===e?void 0:e.data.sessionVerificationRes});(0,n.o7)("Pathfinder -> UserProvider -> processUserSessionRes: ",o);let t=(0,i.Ju)();r.current.isLoggedIn="0"===o.error.code,r.current.sessionProcessedUtms=t,f(t),S(t),(0,n.o7)("Pathfinder -> UserProvider -> session processed -> utms: ",t)};_processUserSession()}},[u]),(0,s.useEffect)(()=>{if(r.current){var e;let o=null!==(e=r.current.isLoggedIn)&&void 0!==e&&e,t=r.current.sessionProcessedUtms;v(o&&t>0)}},[u,g,p]);let m=(0,s.useMemo)(()=>((0,n.o7)("Pathfinder -> UserProvider -> contextValRef.current, sessionSoftLookupUtms, sessionProcessedUtms, stateUpdatedUtms: ",{"contextValRef.current":JSON.parse(JSON.stringify(r.current)),sessionSoftLookupUtms:u,sessionProcessedUtms:g,stateUpdatedUtms:p}),{...r.current,isPageReadyToLoad:h}),[u,g,p,h]);return(0,t.jsx)(c.Provider,{value:m,children:o})}let useUser=()=>(0,s.useContext)(c)},26539:function(e,o,r){var t,s,i,n,a,c=r(55994),d=c&&"object"==typeof c&&"default"in c?c:{default:c};function _extends(){return(_extends=Object.assign?Object.assign.bind():function(e){for(var o=1;o<arguments.length;o++){var r=arguments[o];for(var t in r)Object.prototype.hasOwnProperty.call(r,t)&&(e[t]=r[t])}return e}).apply(this,arguments)}function _getPrototypeOf(e){return(_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function _setPrototypeOf(e,o){return(_setPrototypeOf=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,o){return e.__proto__=o,e})(e,o)}function _construct(e,o,r){return(_construct=!function(){if("undefined"==typeof Reflect||!Reflect.construct||Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}()?function(e,o,r){var t=[null];t.push.apply(t,o);var s=new(Function.bind.apply(e,t));return r&&_setPrototypeOf(s,r.prototype),s}:Reflect.construct.bind()).apply(null,arguments)}function _wrapNativeSuper(e){var o="function"==typeof Map?new Map:void 0;return(_wrapNativeSuper=function(e){if(null===e||-1===Function.toString.call(e).indexOf("[native code]"))return e;if("function"!=typeof e)throw TypeError("Super expression must either be null or a function");if(void 0!==o){if(o.has(e))return o.get(e);o.set(e,Wrapper)}function Wrapper(){return _construct(e,arguments,_getPrototypeOf(this).constructor)}return Wrapper.prototype=Object.create(e.prototype,{constructor:{value:Wrapper,enumerable:!1,writable:!0,configurable:!0}}),_setPrototypeOf(Wrapper,e)})(e)}var u=function(e){function Exception(o){var r,t=o.code,s=o.description,i=o.type,n=void 0===i?"INTERNAL":i,a=o.meta,c=void 0===a?null:a;return console.error({code:t,description:s,type:n,meta:c}),(r=e.call(this,s)||this).code=void 0,r.description=void 0,r.type=void 0,r.meta=void 0,r.name="Exception",r.code=t,r.description=s,r.type=n,r.meta=c,r}return Exception.prototype=Object.create(e.prototype),Exception.prototype.constructor=Exception,_setPrototypeOf(Exception,e),Exception}(_wrapNativeSuper(Error)),getMetaPreparedFromException=function(e){var o={code:"1",description:"Internal server error"};return e instanceof u?(o.code=e.code,o.description=e.description,void 0!==e.meta&&(o.meta=e.meta)):e instanceof Error?o.description=e.message:"string"==typeof e&&(o.description=e),o},currentLogLevel=function(){var e=localStorage.getItem("logLevel");switch(null==e&&(e=localStorage.getItem("level")),e){case"info":return 20;case"debug":return 10;default:return 40}},l={},g=null,flushLogBufferToStorage=function(e){if(void 0!==l[e])try{var o=l[e].logs;if(l[e].flushed){var r=sessionStorage.getItem("log."+e);if(null!=r){var t=JSON.parse(r);"[object Array]"===Object.prototype.toString.call(t)&&t.length&&(o=t.concat(l[e].logs))}}sessionStorage.setItem("log."+e,JSON.stringify(o)),l[e].flushed=!0,l[e].logs=[]}catch(e){logError("flushLogBufferToStorage -> exc: ",e)}},pushToLogBuffer=function(e,o,r,t){void 0===l[e]&&(l[e]={flushed:!1,logs:[]});var s={logLevel:o,message:r,data:t};null!==g&&(s=JSON.parse(g(JSON.stringify(s)))),l[e].logs.push(s),l[e].flushed&&flushLogBufferToStorage(e)},f="",logError=function(e){var o=[].slice.call(arguments,1);console.error(e,o),f&&pushToLogBuffer(f,"error",e,o.length?o:void 0)},p={logError:logError,logDebug:function(e){var o=[].slice.call(arguments,1);10>=currentLogLevel()&&console.log(e,o),f&&pushToLogBuffer(f,"debug",e,o.length?o:void 0)},logDebugAlt:function(e,o,r){10>=currentLogLevel()&&console.log(e,o),void 0===r&&(r=!1),f&&!r&&pushToLogBuffer(f,"debug",e,o)},logInfo:function(e){var o=[].slice.call(arguments,1);20>=currentLogLevel()&&console.log(e,o),f&&pushToLogBuffer(f,"info",e,o.length?o:void 0)},logAll:function(e){var o=[].slice.call(arguments,1);40>=currentLogLevel()&&console.log(e,o),f&&pushToLogBuffer(f,"all",e,o.length?o:void 0)},log:function(e,o){currentLogLevel()<=o&&console.log(e),f&&pushToLogBuffer(f,""+o,e)},pushToLogBuffer:pushToLogBuffer,flushLogBufferToStorage:flushLogBufferToStorage,intializeLogBufferForwarding:function(e){f&&flushLogBufferToStorage(f),f=e},finishLogBufferForwarding:function(e){f&&flushLogBufferToStorage(f),void 0!==e&&e!==f&&flushLogBufferToStorage(e),f=""},clearLogsFromStorage:function(e){sessionStorage.removeItem("log."+e)},bufferlogDebug:function(e,o,r){10>=currentLogLevel()&&console.log(o,r),pushToLogBuffer(e,"debug",o,r)},setLogBufferHook:function(e){g=e},clearLogBufferHook:function(){g=null},currentLogLevel:currentLogLevel},setCookieV2=function(e){var o=e.name,r=e.value,t=e.maxAge,s=e.expires,i=e.domain,n=e.path,a=e.sameSite,c=e.secure,d=o+"="+r+"; domain="+(void 0===i?"w3schools.com":i)+"; path="+(void 0===n?"/":n)+"; SameSite="+(void 0===a?"Strict":a);void 0!==s&&(d+="; expires="+s),void 0!==t&&(d+="; max-age="+t),(void 0===c||c)&&(d+="; Secure"),p.logDebug("setCookie -> cookieToSet: ",d),document.cookie=d},resetCookie=function(e){removeCookie(e.name),setCookieV2(e)},removeCookie=function(e,o,r,t,s){void 0===o&&(o="w3schools.com"),void 0===r&&(r="/"),void 0===t&&(t="Strict"),void 0===s&&(s=!0);var i=e+"=; expires=Thu, 01 Jan 1970 00:00:00 UTC; domain="+o+"; path="+r+"; SameSite="+t;s&&(i+="; Secure"),document.cookie=i},getCookie=function(e){if(void 0!==document&&void 0!==document.cookie){var o=document.cookie.replace(/;\s+/g,";").split(";").find(function(o){return o.startsWith(e+"=")});if(void 0!==o)return o.split("=")[1]}},getCookieValueEncodedStr=function(e){var o=e.str,r=e.mode,t={error:{code:"1",description:'Failed performing "getCookieValueEncodedStr"',meta:{rawStr:o}},data:""};try{2===(void 0===r?2:r)?t.data=btoa(encodeURIComponent(o)).replace(/={1,2}$/,""):t.data=btoa(o),t.error={code:"0"}}catch(e){t.error=getMetaPreparedFromException(e),void 0===t.error.meta&&(t.error.meta={}),t.error.meta.rawStr=o,p.logError("CookieUtil -> getCookieValueEncodedStr -> str: ",o),p.logError("CookieUtil -> getCookieValueEncodedStr -> exc: "),p.logError(e),p.logError("CookieUtil -> getCookieValueEncodedStr -> output: ",t)}return t},getCookieValueDecodedStr=function(e){var o=e.str,r=e.mode,t={error:{code:"1",description:'Failed performing "getCookieValueDecodedStr"',meta:{encodedStr:o}},data:""};try{2===(void 0===r?2:r)?t.data=decodeURIComponent(atob(o+Array((4-o.length%4)%4+1).join("="))):t.data=atob(o),t.error={code:"0"}}catch(e){t.error=getMetaPreparedFromException(e),void 0===t.error.meta&&(t.error.meta={}),t.error.meta.encodedStr=o,p.logError("CookieUtil -> getCookieValueDecodedStr -> str: ",o),p.logError("CookieUtil -> getCookieValueDecodedStr -> exc: "),p.logError(e),p.logError("CookieUtil -> getCookieValueDecodedStr -> output: ",t)}return t},getEnvFromUrl=function(){var e=window.location.hostname;if(void 0!==s)return s;var o="prod";return"profile.w3schools.com"===e||"my-learning.w3schools.com"===e||"spaces.w3schools.com"===e||"pathfinder.w3schools.com"===e||"www.w3profile.com"===e||"w3profile.com"===e?o="prod":"profile-stage.w3schools.com"===e||"myl-stage.w3schools.com"===e||"www.w3profile-stage.com"===e||"spaces-stage.w3schools.com"===e||"pathfinder-stage.w3schools.com"===e||"ui.w3stages.com"===e?o="staging":("profile-dev.w3schools.com"===e||"profile-local.w3schools.com"===e||"www.w3profile-local.com"===e||"www.w3profile-dev.com"===e||"myl-dev.w3schools.com"===e||"myl-local.w3schools.com"===e||"spaces-dev.w3schools.com"===e||"spaces-local.w3schools.com"===e||"pathfinder-dev.w3schools.com"===e||"pathfinder-local.w3schools.com"===e||"prototyping.w3sdevelop.com"===e||"localhost"===e)&&(o="develop"),s=o,o},getAppFromUrl=function(){var e=window.location.hostname;if(void 0!==i)return i;var o="";return"profile.w3schools.com"===e||"profile-stage.w3schools.com"===e||"profile-dev.w3schools.com"===e||"profile-local.w3schools.com"===e?o="profile":"spaces.w3schools.com"===e||"spaces-stage.w3schools.com"===e||"spaces-dev.w3schools.com"===e||"spaces-local.w3schools.com"===e||"prototyping.w3sdevelop.com"===e?o="spaces":"pathfinder.w3schools.com"===e||"pathfinder-stage.w3schools.com"===e||"pathfinder-dev.w3schools.com"===e||"pathfinder-local.w3schools.com"===e?o="pathfinder":"my-learning.w3schools.com"===e||"myl-stage.w3schools.com"===e||"myl-dev.w3schools.com"===e||"myl-local.w3schools.com"===e?o="my-learning":("www.w3profile-local.com"===e||"www.w3profile-stage.com"===e||"www.w3profile-dev.com"===e||"w3profile.com"===e||"www.w3profile.com"===e)&&(o="public-profile"),i=o,o},appIsProfile=function(){return"profile"===getAppFromUrl()},getEnv=function(){if(void 0!==n)return n;var e=getCookie("alternative_auth");return void 0===e&&(e=getEnvFromUrl()),n=e,e},getProfileUrl=function(){switch(getEnv()){case"prod":default:return"https://profile.w3schools.com";case"develop":return"https://profile-dev.w3schools.com";case"staging":return"https://profile-stage.w3schools.com"}},getLoginUrl=function(){return getProfileUrl()+"/log-in"},getProfileRefreshSessionUrl=function(){return getProfileUrl()+"/refresh-session"},getCurrentUrlClean=function(){return"/"===window.location.pathname?window.location.origin:""+window.location.origin+window.location.pathname},S={develop:{region:"us-east-1",userPoolId:"us-east-1_bJP6gg7TK",userPoolWebClientId:"7qg16lngs4v8d06mlth1tevff0",userSessionLogicVersion:"1.0.0",authDomain:"auth.w3sdevelop.com"},staging:{region:"us-east-1",userPoolId:"us-east-1_U6QSH6gig",userPoolWebClientId:"n9q3fkj1gdjg390800flvsah1",userSessionLogicVersion:"1.0.0",authDomain:"auth.w3stages.com"},prod:{region:"us-east-1",userPoolId:"us-east-1_uG9SGX7Wd",userPoolWebClientId:"d1grqml0emh7votkb0gtrrn0",userSessionLogicVersion:"1.0.0",authDomain:"auth.w3spaces.com"}},getCognitoConfig=function(e){return(void 0===e&&(e=getEnv()),p.logDebug("getCognitoConfig -> env: ",e),void 0!==S[e])?S[e]:S.prod},getPrmType=function(e){var o=Object.prototype.toString.call(e);return(o=o.substring(8)).substring(0,o.length-1)},getADeepCopy=function getADeepCopy(e,o){void 0===o&&(o={});var r,t="";for(r in e)if(e.hasOwnProperty(r)){if("Object"===(t=getPrmType(e[r])))o[r]=getADeepCopy(e[r],{});else if("Array"===t)o[r]=getADeepCopy(e[r],[]);else{if("Function"===t)continue;o[r]=e[r]}}return o},parseJson=function(e){var o=e.jsonStr,r=e.requiredFields,t={error:{code:"0"},data:{}};try{if(t.data=JSON.parse(o),void 0!==r)for(var s=0;s<r.length;s++){var i=r[s];if(void 0===t.data[i]){t.error={code:"FINPID",description:"Field is not present in data",meta:{key:i}};break}}}catch(e){t.error=getMetaPreparedFromException(e)}return t},getDictSnapshot=function(e){return JSON.parse(JSON.stringify(e))};(t=a||(a={})).LoggedOut="0",t.Active="1",t.LegacySendToRefresh="-1",t.LoginRequired="-2",t.RefreshRequired="-3";var h={timeout:45e3},fetch=function fetch(e){try{var _temp16=function(){function _temp14(){p.logDebug("fetch -> output: ",o);var r,t=function(){if("0"!==o.error.code&&void 0!==o.error.meta&&null!==o.error.meta&&void 0!==o.error.meta.failedCognitoAuth&&!0===o.error.meta.failedCognitoAuth&&!e._retriedAfterSessionRefresh){var t=e.refreshTokenOnFailedCognitoAuth||h.refreshTokenOnFailedCognitoAuth;return function(){if(t){var _temp11=function(){return p.logDebug("fetch -> processUserSessionRes (2): ",o),function(){if(void 0!==o&&"0"===o.error.code)return e._retriedAfterSessionRefresh=!0,Promise.resolve(fetch(e)).then(function(e){return r=1,e})}()};void 0!==e.changeStatusCodeInUserSessionCookiesRef?e.changeStatusCodeInUserSessionCookiesRef({newStatusCode:a.RefreshRequired}):void 0!==h.changeStatusCodeInUserSessionCookiesRef?h.changeStatusCodeInUserSessionCookiesRef({newStatusCode:a.RefreshRequired}):p.logError("fetch -> processUserSessionRes -> changeStatusCodeInUserSessionCookiesRef is not set");var o=void 0,s=function(){if(void 0!==e.processUserSessionRef)return Promise.resolve(e.processUserSessionRef({context:"FetchUtil -> fetch -> post request (1)",preferDethrottleCache:!1})).then(function(e){o=e});var r=function(){if(void 0!==h.processUserSessionRef)return Promise.resolve(h.processUserSessionRef({context:"FetchUtil -> fetch -> post request (2)",preferDethrottleCache:!1})).then(function(e){o=e})}();if(r&&r.then)return r.then(function(){})}();return s&&s.then?s.then(_temp11):_temp11(s)}}()}}();return t&&t.then?t.then(function(e){return r?e:o}):r?t:o}void 0!==e.attachCookies&&(e.withCredentials=e.attachCookies),void 0!==e.withCredentials&&e.withCredentials&&void 0!==h.attachCookieHeader&&h.attachCookieHeader&&(e.headers.Cookie=window.document.cookie),void 0!==e.cache&&(e.cache=!1),!1===e.cache&&void 0===e.headers["Cache-Control"]&&(e.headers["Cache-Control"]="no-cache"),void 0===e.validateStatus&&(e.validateStatus=function(){return!0}),"GET"===e.method&&void 0!==e.data&&(e.url+="?"+getSerializedUrlQueryPrs(e.data),delete e.data),void 0===e._retriedAfterSessionRefresh&&(e._retriedAfterSessionRefresh=!1);var o,r=function(e,o){try{var r=e()}catch(e){return o(e)}return r&&r.then?r.then(void 0,o):r}(function(){return Promise.resolve(d.default(e)).then(function(r){return Promise.resolve(getPreparedResponse(r,e)).then(function(e){o=e})})},function(r){o=getPreparedResponseFromException(r,e)});return r&&r.then?r.then(_temp14):_temp14(r)};void 0===e.method&&(e.method="POST"),void 0===e.timeout&&(e.timeout=h.timeout),void 0===e.maxContentLength&&void 0!==h.maxContentLength&&(e.maxContentLength=h.maxContentLength),void 0===e.maxBodyLength&&void 0!==h.maxBodyLength&&(e.maxBodyLength=h.maxBodyLength),void 0===e.headers&&(e.headers={}),void 0===e.headers["Content-Type"]&&(e.headers["Content-Type"]="application/json"),void 0===e.authenticated&&(e.authenticated=!0),p.logDebug("fetch -> prs: ",e);var o=function(){if(e.authenticated){var o=e.authHeaderKey||"Authorization",r=function(){if(void 0===e.headers[o]){var r,_temp7=function(){void 0!==r&&r&&(p.logDebug("fetch -> attachUserSessionHeader -> accessToken: ",r),e.headers[o]="Bearer "+r)};p.logDebug("fetch -> attachUserSessionHeader -> initialize");var t=function(){if(void 0!==e.authBearerToken)r=e.authBearerToken;else{var _temp5=function(){r=getCookie("accessToken")},o=e.refreshTokenOnFailedCognitoAuth||h.refreshTokenOnFailedCognitoAuth,t=function(){if(o){var _temp3=function(){p.logDebug("fetch -> processUserSessionRes (1): ",r)},r=void 0,t=function(){if(void 0!==e.processUserSessionRef)return Promise.resolve(e.processUserSessionRef({context:"FetchUtil -> fetch -> pre request (1)",preferDethrottleCache:!1})).then(function(e){r=e});var o=function(){if(void 0!==h.processUserSessionRef)return Promise.resolve(h.processUserSessionRef({context:"FetchUtil -> fetch -> pre request (2)",preferDethrottleCache:!1})).then(function(e){r=e})}();if(o&&o.then)return o.then(function(){})}();return t&&t.then?t.then(_temp3):_temp3(t)}}();return t&&t.then?t.then(_temp5):_temp5(t)}}();return t&&t.then?t.then(_temp7):_temp7(t)}}();if(r&&r.then)return r.then(function(){})}}();return Promise.resolve(o&&o.then?o.then(_temp16):_temp16(o))}catch(e){return Promise.reject(e)}},getErrorByResponseStatus=function(e,o){try{if(void 0!==e.status&&e.status&&void 0!==v[""+e.status]){var r=v[""+e.status],t=r.code,s=r.description,i={origin:"getErrorByResponseStatus"};return"UNAUTHORIZED"===t&&(o.authenticated||o.withCredentials)&&(void 0===e.data.error||void 0===e.data.error.code)&&(p.logError("getErrorByResponseStatus -> failedCognitoAuth -> res, prs: ",e,o),i.failedCognitoAuth=!0),Promise.resolve({code:t,description:s,meta:i})}return p.logError("getErrorByResponseStatus -> res: ",e),Promise.resolve({code:"INTERNAL_SERVER_ERROR",description:"Internal server error",meta:{origin:"getErrorByResponseStatus",res:e}})}catch(e){return Promise.reject(e)}},getPreparedResponse=function(e,o){try{var r,_temp20=function(){return"0"===r.code||void 0!==r.description&&r.description||(r.description="Internal server error"),e.error=r,p.logDebug("getPreparedResponse -> error: ",r),void 0!==t.data&&(e.data=t.data),e.rawData="",e};p.logDebug("getPreparedResponse -> res: ",e),p.logDebug("getPreparedResponse -> prs: ",o);var t=e.data;if(void 0!==t.error&&void 0!==t.error.code)r=getADeepCopy(t.error);else if(void 0!==t["error.code"]){var s=o.cleanupErrorMetaFromData||!1;r={code:t["error.code"]},s&&delete t["error.code"],void 0!==t["error.description"]&&(r.description=t["error.description"],s&&delete t["error.description"]),void 0!==t["error.meta"]&&(r.meta=t["error.meta"],s&&delete t["error.meta"])}else r={code:"0"};var i=function(){if(("0"===r.code||"1"===r.code)&&void 0!==e.status&&e.status&&!(e.status>=200&&e.status<300))return Promise.resolve(getErrorByResponseStatus(e,o)).then(function(e){r=e})}();return Promise.resolve(i&&i.then?i.then(_temp20):_temp20(i))}catch(e){return Promise.reject(e)}},getPreparedResponseFromException=function(e,o){return p.logDebug("getPreparedResponseFromException -> exc: ",e),p.logDebug("getPreparedResponseFromException -> prs: ",o),{status:e.status,rawData:"",data:{},error:{code:e.status?""+e.status:"FINESIS",description:e.message?e.message:"Internal server error"}}},getSerializedUrlQueryPrs=function getSerializedUrlQueryPrs(e,o){var r,t=[];for(r in e)if(e.hasOwnProperty(r)){var s=o?o+"["+r+"]":r,i=e[r];t.push(null!==i&&"object"==typeof i?getSerializedUrlQueryPrs(i,s):encodeURIComponent(s)+"="+encodeURIComponent(i))}return t.join("&")},v={100:{code:"CONTINUE",description:"Continue"},101:{code:"SWITCHING_PROTOCOLS",description:"Switching Protocols"},102:{code:"PROCESSING",description:"Processing"},200:{code:"OK",description:"OK"},201:{code:"CREATED",description:"Created"},202:{code:"ACCEPTED",description:"Accepted"},203:{code:"NON_AUTHORITATIVE_INFORMATION",description:"Non Authoritative Information"},204:{code:"NO_CONTENT",description:"No Content"},205:{code:"RESET_CONTENT",description:"Reset Content"},206:{code:"PARTIAL_CONTENT",description:"Partial Content"},207:{code:"MULTI_STATUS",description:"Multi-Status"},300:{code:"MULTIPLE_CHOICES",description:"Multiple Choices"},301:{code:"MOVED_PERMANENTLY",description:"Moved Permanently"},302:{code:"MOVED_TEMPORARILY",description:"Moved Temporarily"},303:{code:"SEE_OTHER",description:"See Other"},304:{code:"NOT_MODIFIED",description:"Not Modified"},305:{code:"USE_PROXY",description:"Use Proxy"},307:{code:"TEMPORARY_REDIRECT",description:"Temporary Redirect"},308:{code:"PERMANENT_REDIRECT",description:"Permanent Redirect"},400:{code:"BAD_REQUEST",description:"Bad Request"},401:{code:"UNAUTHORIZED",description:"Unauthorized"},402:{code:"PAYMENT_REQUIRED",description:"Payment Required"},403:{code:"FORBIDDEN",description:"Forbidden"},404:{code:"NOT_FOUND",description:"Not Found"},405:{code:"METHOD_NOT_ALLOWED",description:"Method Not Allowed"},406:{code:"NOT_ACCEPTABLE",description:"Not Acceptable"},407:{code:"PROXY_AUTHENTICATION_REQUIRED",description:"Proxy Authentication Required"},408:{code:"REQUEST_TIMEOUT",description:"Request Timeout"},409:{code:"CONFLICT",description:"Conflict"},410:{code:"GONE",description:"Gone"},411:{code:"LENGTH_REQUIRED",description:"Length Required"},412:{code:"PRECONDITION_FAILED",description:"Precondition Failed"},413:{code:"REQUEST_TOO_LONG",description:"Request Entity Too Large"},414:{code:"REQUEST_URI_TOO_LONG",description:"Request-URI Too Long"},415:{code:"UNSUPPORTED_MEDIA_TYPE",description:"Unsupported Media Type"},416:{code:"REQUESTED_RANGE_NOT_SATISFIABLE",description:"Requested Range Not Satisfiable"},417:{code:"EXPECTATION_FAILED",description:"Expectation Failed"},418:{code:"IM_A_TEAPOT",description:"I'm a teapot"},419:{code:"INSUFFICIENT_SPACE_ON_RESOURCE",description:"Insufficient Space on Resource"},420:{code:"METHOD_FAILURE",description:"Method Failure"},421:{code:"MISDIRECTED_REQUEST",description:"Misdirected Request"},422:{code:"UNPROCESSABLE_ENTITY",description:"Unprocessable Entity"},423:{code:"LOCKED",description:"Locked"},424:{code:"FAILED_DEPENDENCY",description:"Failed Dependency"},428:{code:"PRECONDITION_REQUIRED",description:"Precondition Required"},429:{code:"TOO_MANY_REQUESTS",description:"Too Many Requests"},431:{code:"REQUEST_HEADER_FIELDS_TOO_LARGE",description:"Request Header Fields Too Large"},451:{code:"UNAVAILABLE_FOR_LEGAL_REASONS",description:"Unavailable For Legal Reasons"},500:{code:"INTERNAL_SERVER_ERROR",description:"Internal Server Error"},501:{code:"NOT_IMPLEMENTED",description:"Not Implemented"},502:{code:"BAD_GATEWAY",description:"Bad Gateway"},503:{code:"SERVICE_UNAVAILABLE",description:"Service Unavailable"},504:{code:"GATEWAY_TIMEOUT",description:"Gateway Timeout"},505:{code:"HTTP_VERSION_NOT_SUPPORTED",description:"HTTP Version Not Supported"},507:{code:"INSUFFICIENT_STORAGE",description:"Insufficient Storage"},511:{code:"NETWORK_AUTHENTICATION_REQUIRED",description:"Network Authentication Required"}},getProfileBaseUrl=function(e){if(void 0===e&&(e=getEnv()),"prod"===e);else if("staging"===e)return"https://profile-stage.w3schools.com";else if("develop"===e)return"https://profile-dev.w3schools.com";return"https://profile.w3schools.com"},fetchProfileUserSession=function(e){try{return e.baseURL=""+getProfileBaseUrl(void 0)+"/api/user/session",void 0===e.url&&(e.url=""),void 0===e.authHeaderKey&&(e.authHeaderKey="x-access-token"),Promise.resolve(fetch(e))}catch(e){return Promise.reject(e)}};window.liteFetch=function(e,o,r,t,s){void 0===s&&(s=15e3);var i=new XMLHttpRequest,n={error:{code:"0"},status:0,dataStr:"",data:null,xhr:i},a=setTimeout(function(){n.error={code:"RWTE",description:"Request wait time exceeded"},t(n)},s);i.onreadystatechange=function(){4==this.readyState&&(clearTimeout(a),n.status=this.status,n.dataStr=this.responseText,void 0!==n.status&&n.status?401==n.status?n.error={code:"UNAUTHORIZED",description:"Request unauthorized"}:n.status>=200&&n.status<300||(n.error={code:"RSC_"+n.status,description:void 0!==this.statusText&&this.statusText?this.statusText:"Request failed"}):n.error={code:"RTWNSC",description:"Request failed"},t(n))},i.open(e,o,!0),i.send(r)};var getLocalCurrentUts=function(){return Math.floor(new Date().getTime()/1e3)},rs=function(e){return e.split("").reverse().join("")},mts=function(e,o){return e.slice(-o)+e.slice(0,-o)},bap=function(e){return e+Array((4-e.length%4)%4+1).join("=")},syncUnpack=function(e,o){try{void 0===o&&(o=!1);try{r=JSON.parse(decodeURIComponent(rs(atob(bap(rs(mts(e,10)))))))}catch(o){r=JSON.parse(rs(atob(bap(rs(mts(e,10))))))}var r,t=new Date().getTime()+6e4*new Date().getTimezoneOffset();if(!o){if(void 0===r._exp)throw Error("Cookie data is not valid");if(Math.round(t/1e3)>=r._exp)throw Error("Cookie data has expired")}return delete r._exp,r}catch(e){console.error(e)}return null},m=null,U=0,logOut=function(e){var o=e.context,r=e.skipBackendUserSessionDeletion,t=e.skipUserSessionStatusCodeCookieChange,s=void 0!==t&&t,i=e.reason;try{if(p.logDebug("logOut -> init: ",{context:o,skipBackendUserSessionDeletion:void 0!==r&&r,skipUserSessionStatusCodeCookieChange:s,reason:i}),appIsProfile())throw new u({code:"CUSTUSBUOOPA",description:"Common user session termination util should be used outside of profile app"});var n=getCookie("userSession");return setUserSessionCookieDebugMeta({origin:window.location.href,context:o,description:"logOut",reason:i,prevStatusCode:n,newStatusCode:s?n:a.LoggedOut,extra:{skipUserSessionStatusCodeCookieChange:s}}),Promise.resolve(_tmpDebugUserSession(!0)).then(function(){s||changeStatusCodeInUserSessionCookies({newStatusCode:a.LoggedOut})})}catch(e){return Promise.reject(e)}},verifyUserSession=function(e){var o=e.cognitoCfg,r=e.earlyVerifyAccessToken,t="FPVUS",s={error:{code:t,description:'Failed performing "verifyUserSession"'},data:{}},i=getCookie("userSession"),n=getCookie("userSessionMeta"),c=getCookie("accessToken"),d=void 0;void 0!==r&&r&&(d=verifyAccessToken({cognitoCfg:o,accessToken:c}),s.data=d.data);var u=void 0!==i&&i,l=void 0!==n&&n,g=void 0!==c&&c;if(!g&&!u)return s.error={code:"USNF",description:"User session not found",meta:{origin:"verifyUserSession"}},s;if(u&&i===a.LoggedOut)return s.error={code:"USNF",description:"User session not found",meta:{origin:"verifyUserSession",legacy:!1,logOut:!0,flow:'Explicit "userSessionStatusCode" flag'}},s;if(u&&i===a.LegacySendToRefresh)return s.error={code:"USSBR",description:"User session should be refreshed via redirect",meta:{legacy:!0,flow:'Explicit "userSessionStatusCode" flag'}},s;if(u&&i===a.LoginRequired)return s.error={code:"USLA",description:"User should login again",meta:{legacy:!1,flow:'Explicit "userSessionStatusCode" flag'}},s;if(u&&i===a.RefreshRequired)return s.error={code:"ATSBR",description:"Access token should be refreshed",meta:{legacy:!l,flow:'Explicit "userSessionStatusCode" flag'}},s;if(!l&&u&&!g)return s.error={code:"USHE",description:"User session has expired",meta:{legacy:!0}},s;if(l){var f=getUserSessionCookieMeta();if("0"!==f.error.code)return s.error={code:"USMINV",description:"User session meta is not valid",meta:{legacy:!1,getUserSessionCookieMetaRes:f}},s;var p=getLocalCurrentUts();if(f.data.rtexp<p)return s.error={code:"RTHE",description:"Refresh token has expired",meta:{legacy:!1}},s;if(f.data.atexp<p)return s.error={code:"ATHE",description:"Access token has expired",meta:{legacy:!1}},s}return(void 0===d&&(d=verifyAccessToken({cognitoCfg:o,accessToken:c}),s.data=d.data),s.error.code===t&&"0"!==d.error.code)?s.error=d.error:s.error={code:"0"},s},verifyAccessToken=function(e){var o=e.cognitoCfg,r=e.accessToken,t=e.parseHeader,s={error:{code:"FPVAT",description:'Failed performing "verifyAccessToken"'},data:{}},i=parseAccessToken({accessToken:r,parseHeader:void 0!==t&&t});if(s.data=i.data,s.data.rawStr=r,"0"!==i.error.code)return s.error=i.error,s;var n=i.data.payload,a="https://cognito-idp."+o.region+".amazonaws.com/"+o.userPoolId;return n.iss!==a?s.error={code:"ATINVCIDNM",description:"Access token is not valid. Claim issuer does not match",meta:{accessToken:r,issuer:a,claim:n}}:"access"!==n.token_use?s.error={code:"ATINVCUINA",description:"Access token is not valid. Claim use is not access",meta:{accessToken:r,claim:n}}:s.error={code:"0"},s},parseAccessToken=function(e){var o=e.accessToken,r=e.parseHeader,t={error:{code:"0"},data:{}};if(void 0===o||!o)return t.error={code:"USNF",description:"User session not found"},t;try{var s=o.split(".");if(s.length<3)return t.error={code:"ATINVWNOTS",description:"Access token is not valid. Wrong number of token sections",meta:{accessToken:o,accessTokenSections:s}},t;var i=void 0;if(void 0!==r&&r){var n=s[0],a=decodeBase64UrlEncodedJwtSection(n);if("0"!==a.error.code)return t.error={code:"ATINVFDTTH",description:"Access token is not valid. Failed decoding the token header",meta:{accessToken:o,accessTokenHeaderEncodedStr:n,decodingError:a.error}},t;var c=parseJson({jsonStr:a.data,requiredFields:["kid","alg"]});if("0"!==c.error.code)return t.error={code:"ATINVFPTH",description:"Access token is not valid. Failed parsing token header",meta:{accessToken:o,accessTokenHeaderEncodedStr:n,accessTokenHeaderDecodedStr:a.data,parseError:c.error}},t;i=c.data}var d=s[1],u=decodeBase64UrlEncodedJwtSection(d);if("0"!==u.error.code)return t.error={code:"ATINVFDTTP",description:"Access token is not valid. Failed decoding the token payload",meta:{accessToken:o,accessTokenPayloadEncodedStr:d,decodingError:u.error}},t;var l=parseJson({jsonStr:u.data,requiredFields:["sub","token_use","scope","auth_time","iss","exp","iat","jti","client_id","username"]});if("0"!==l.error.code)return t.error={code:"ATINVFPTP",description:"Access token is not valid. Failed parsing token payload",meta:{accessToken:o,accessTokenPayloadEncodedStr:d,accessTokenPayloadDecodedStr:u.data,parseError:l.error}},t;var g=l.data,f=parseInt(g.exp),p=new Date(1e3*f),S=getLocalCurrentUts(),h=S+43140,v=new Date(1e3*h);t.data={rawStr:o,header:i,payload:g,expiryDto:p,expiryUts:f,ttl:43140,localCurrentUts:S,localExpiryUts:h,localExpiryDto:v}}catch(e){t.error=getMetaPreparedFromException(e)}return t},getUserSessionCookieMeta=function(){var e={error:{code:"1",description:'Failed performing "getUserSessionCookieMeta"'},data:{}},o=getCookie("userSessionMeta");if(void 0===o||!o)return e.error={code:"USMCINP",description:"User session meta cookie is not present"},e;var r=getCookieValueDecodedStr({str:o,mode:1});if("0"!==r.error.code)return e.error={code:"DFUSMC",description:"Failed decoding user session meta cookie",meta:{userSessionMetaRawStr:o,userSessionMetaRawStrDecodeRes:r}},e;var t=r.data;if(0!==t.indexOf("{"))return e.error={code:"USMCINV1",description:"User session meta cookie is not valid",meta:{userSessionMetaRawStr:o,userSessionMetaRawJsonStr:t}},e;var s=parseJson({jsonStr:t,requiredFields:["id","iss","atexp","rtexp"]});return"0"!==s.error.code?e.error={code:"FPUSMC",description:"Failed parsing user session meta cookie",meta:{userSessionMetaRawJsonStr:t,userSessionMetaParseRes:s}}:(e.data=s.data,e.error={code:"0"}),e},getAccessTokenCookieLifespan=function(e){var o=void 0===e?{}:e,r=o.userSessionMeta,t=o.userSessionLifespan,s={error:{code:"1",description:'Failed performing "getAccessTokenCookieLifespan"'},data:{}},i=getLocalCurrentUts(),n=0;if(void 0!==t)n=t.accessTokenExpiryUiUts>t.refreshTokenExpiryUiUts?t.accessTokenExpiryUiUts:t.refreshTokenExpiryUiUts;else if(void 0===r){var a=getUserSessionCookieMeta();if("0"!==a.error.code)return s.error=a.error,s;r=a.data}return 0===n&&void 0!==r&&(n=r.atexp>r.rtexp?r.atexp:r.rtexp),s.data={currentUts:i,expiryUts:n,expiryDto:new Date(1e3*n),ttl:n-i},s.error={code:"0"},s},changeStatusCodeInUserSessionCookies=function(e){var o=e.newStatusCode,r=getLocalCurrentUts()+7776e3,t=new Date(1e3*r);resetCookie({name:"userSession",value:o,maxAge:7776e3,expires:t});var s=getCookie("userSessionMeta");void 0!==s&&s&&resetCookie({name:"userSessionMeta",value:s,maxAge:7776e3,expires:t})},upsertActiveUserSessionCookies=function(e){var o=e.accessToken,r=e.userInfoCookie,t=e.sessionId,s=e.sessionLifespan,i={error:{code:"1",description:'Failed performing "upsertActiveUserSessionCookies"'},data:{}},n=s.currentUiUts+7776e3,c=new Date(1e3*n);if(void 0===t){var d=getUserSessionCookieMeta();if("0"!==d.error.code)return i.error={code:"FRUSM",description:"Failed retrieving user session meta",meta:{getUserSessionCookieMetaRes:d}},i;t=d.data.id}var u={id:t,iss:s.refreshTokenBaseUiUts,atexp:s.accessTokenExpiryUiUts,rtexp:s.refreshTokenExpiryUiUts},l=getAccessTokenCookieLifespan({userSessionLifespan:s});if("0"!==l.error.code)return i.error={code:"FRATCL",description:"Failed retrieving access token cookie lifespan",meta:{getAccessTokenCookieLifespanRes:l}},i;var g=getCookieValueEncodedStr({str:JSON.stringify(u),mode:1});if("0"!==g.error.code)return i.error={code:"FEUSMD",description:"Failed encoding user session meta data",meta:{userSessionMetaEncodingRes:g}},i;resetCookie({name:"userSession",value:a.Active,maxAge:7776e3,expires:c}),resetCookie({name:"userSessionMeta",value:g.data,maxAge:7776e3,expires:c});var f=l.data.ttl,p=l.data.expiryDto;return resetCookie({name:"accessToken",value:o,maxAge:f,expires:p}),resetCookie({name:"__c_u_i_1",value:r,maxAge:f,expires:p}),i.data=_extends({},u,{statusCode:a.Active}),i.error={code:"0"},i},setUserSessionRefreshFlag=function(e){var o=e.context,r=e.reason;p.logDebug("UserSessionUtil -> setUserSessionRefreshFlag -> context: ",o),setUserSessionCookieDebugMeta({origin:window.location.href,context:o,description:"setUserSessionRefreshFlag",reason:r,prevStatusCode:getCookie("userSession"),newStatusCode:a.LegacySendToRefresh}),changeStatusCodeInUserSessionCookies({newStatusCode:a.LegacySendToRefresh})},refreshUserSessionViaRedirect=function(e){var o=e.context,r=e.originUrl,t=e.reason;p.logDebug("UserSessionUtil -> refreshUserSessionViaRedirect -> init: ",{originUrl:r,context:o});var s=getCurrentUrlClean();if(s===getProfileRefreshSessionUrl()){p.logDebug("UserSessionUtil -> refreshUserSessionViaRedirect -> landed -> currentUrlClean: ",s);return}setUserSessionRefreshFlag({context:o,reason:t});var i=getProfileRefreshSessionUrl()+"?redirect_url="+encodeURIComponent(r);p.logDebug("UserSessionUtil -> refreshUserSessionViaRedirect -> redirectUrl: ",i),"true"!==localStorage.getItem("skipRedirect")&&(window.location.href=i)},restartUserSessionViaRedirect=function(e){var o=e.context,r=e.originUrl,t=e.reason;p.logDebug("UserSessionUtil -> restartUserSessionViaRedirect -> init: ",{originUrl:r,context:o});var s=getCurrentUrlClean();if(s===getLoginUrl()||s===getProfileUrl()){p.logDebug("UserSessionUtil -> restartUserSessionViaRedirect -> landed -> currentUrlClean: ",s);return}setUserSessionCookieDebugMeta({origin:r,context:o,description:"restartUserSessionViaRedirect",reason:t,prevStatusCode:getCookie("userSession"),newStatusCode:a.LoginRequired}),changeStatusCodeInUserSessionCookies({newStatusCode:a.LoginRequired});var i=getLoginUrl()+"?redirect_url="+encodeURIComponent(r);p.logDebug("UserSessionUtil -> restartUserSessionViaRedirect -> redirectUrl: ",i),"true"!==localStorage.getItem("skipRedirect")&&(window.location.href=i)},_refreshBackendUserSession=function(e){try{p.logDebug("(1) _refreshBackendUserSession -> init: ",{context:e});var o=getCookie("accessToken");if(void 0===o||!o){var r={error:{code:"RUS_ATINPIC",description:"Access token is not present in cookies",meta:{context:e}},data:null};return p.logDebug("(E1) _refreshBackendUserSession -> context, output: ",{context:e,output:r}),Promise.resolve(r)}return Promise.resolve(fetchProfileUserSession({method:"POST",data:{method:"PATCH",currentUiUts:getLocalCurrentUts()},authenticated:!1,attachCookies:!0})).then(function(o){if("0"!==o.error.code){var r={error:{code:"RUS_FRUS",description:"Failed refreshing user session",meta:{context:e,reqRes:o}},data:null};return p.logDebug("(E4) _refreshBackendUserSession -> context, output: ",{context:e,output:r}),r}return p.logDebug("(FIN) _refreshBackendUserSession -> context, output: ",{context:e,output:o}),o})}catch(e){return Promise.reject(e)}},C={inProgress:!1,awaitingResult:{}},R=(function(e,o,r,t){if(p.logDebug("(1) _callbackParallelRefreshUserSessionExecutionResponse -> context, awaitId, iteration: ",{context:e,awaitId:o,iteration:r}),void 0===C.awaitingResult[o]){var s={error:{code:"AIDINPIQRUSSAR1",description:'Await id is not present in queue "refreshUserSessionState.awaitingResult"',meta:{context:e,awaitId:o,iteration:r}},data:{}};return p.logDebug("(E1) _callbackParallelRefreshUserSessionExecutionResponse -> context, awaitId, iteration, res: ",{context:e,awaitId:o,iteration:r,res:s}),t(s)}if(30===r){delete C.awaitingResult[o];var i={error:{code:"MRRWPAPRUSER",description:'Maximum recursion reached while perfofrming "_awaitParallelRefreshUserSessionExecutionResponse"',meta:{context:e,awaitId:o,iteration:r}},data:{}};return p.logDebug("(E2) _callbackParallelRefreshUserSessionExecutionResponse -> context, awaitId, iteration, res: ",{context:e,awaitId:o,iteration:r,res:i}),t(i)}setTimeout(function(){if(void 0===C.awaitingResult[o]){var s={error:{code:"AIDINPIQRUSSAR2",description:'Await id is not present in queue "refreshUserSessionState.awaitingResult"',meta:{context:e,awaitId:o,iteration:r}},data:{}};return p.logDebug("(E3) _callbackParallelRefreshUserSessionExecutionResponse -> context, awaitId, iteration, res: ",{context:e,awaitId:o,iteration:r,res:s}),t(s)}if(null!==C.awaitingResult[o]){var i=getDictSnapshot(C.awaitingResult[o]);delete C.awaitingResult[o],p.logDebug("(2) _callbackParallelRefreshUserSessionExecutionResponse -> context, awaitId, iteration, res: ",{context:e,awaitId:o,iteration:r,res:i}),void 0===i.error.meta&&(i.error.meta={}),i.error.meta.context=e,i.error.meta.awaitId=o,i.error.meta.iteration=r,t(i)}else R(e,o,++r,t)},500)}).bind(C),_awaitParallelRefreshUserSessionExecutionResponse=function(e,o){try{return Promise.resolve(new Promise(function(r){R(e,o,0,function(t){"0"!==t.error.code&&0!==t.error.code.indexOf("RUS_")&&(t.error.code="RUS_"+t.error.code),p.logDebug("_awaitParallelRefreshUserSessionExecutionResponse -> context, awaitId, res: ",{context:e,awaitId:o,res:t}),r(t)})}))}catch(e){return Promise.reject(e)}},k=(function(e,o,r){try{var _temp16=function(){function _temp14(t){if(r)return t;function _temp12(){var o="0"===s.error.code&&void 0!==s.data.recentlyConsumed&&s.data.recentlyConsumed;if(o){var r=verifyUserSession({cognitoCfg:getCognitoConfig()});"0"!==r.error.code&&(s.error={code:"RUS_RSTWCRBNWSCBF",description:"Refresh session tokens were consumed recently but no working session can be found",meta:{context:e,verifyUserSessionRes:r}})}if("0"===s.error.code&&!o){var t=upsertActiveUserSessionCookies(s.data);p.logDebug("(2) refreshUserSession -> context, upsertActiveUserSessionCookiesRes: ",{context:e,upsertActiveUserSessionCookiesRes:t}),"0"!==t.error.code&&(s.error={code:"RUS_FUAUSC",description:"Failed upserting active user session cookies",meta:{context:e,upsertActiveUserSessionCookiesRes:t}})}p.logDebug("(3) refreshUserSession -> context, output: ",{context:e,output:s}),"0"!==s.error.code&&(p.logDebug("(4) refreshUserSession -> new log-in required -> context, output: ",{context:e,output:s}),setUserSessionCookieDebugMeta({origin:window.location.href,context:e,description:"refreshUserSession",reason:s,prevStatusCode:getCookie("userSession"),newStatusCode:a.LoginRequired}),changeStatusCodeInUserSessionCookies({newStatusCode:a.LoginRequired})),void 0===s.error.meta&&(s.error.meta={}),s.error.meta.context=e,C.inProgress=!1,p.logDebug("(5) refreshUserSession -> before return -> context, refreshUserSessionState: ",{context:e,refreshUserSessionState:getDictSnapshot(C)});var i=Object.keys(C.awaitingResult);if(i.length)for(var n in i){var c=i[n];C.awaitingResult[c]=s}return s}C.inProgress=!0;var s,i=void 0!==o?Promise.resolve(o(e)).then(function(e){s=e}):Promise.resolve(_refreshBackendUserSession(e)).then(function(e){s=e});return i&&i.then?i.then(_temp12):_temp12(i)}var r,t=function(){if(C.inProgress){var o=""+new Date().getTime();return C.awaitingResult[o]=null,Promise.resolve(_awaitParallelRefreshUserSessionExecutionResponse(e,o)).then(function(e){return r=1,e})}}();return t&&t.then?t.then(_temp14):_temp14(t)};p.logDebug("(1) refreshUserSession -> init: ",{context:e,refreshUserSessionState:getDictSnapshot(C),_altRefreshBackendUserSession:o,_sleepBeforeInit:r});var t=function(){if(void 0!==r&&r>0)return Promise.resolve(new Promise(function(e){return setTimeout(e,r)})).then(function(){})}();return Promise.resolve(t&&t.then?t.then(_temp16):_temp16(t))}catch(e){return Promise.reject(e)}}).bind(C),userSessionRedirectionLogicHandler=function(e){if(p.logDebug("userSessionRedirectionLogicHandler -> userSessionVerificationRes: ",e),"0"!==e.error.code){var o=appIsProfile(),r=getCurrentUrlClean();"USSBR"===e.error.code||"USHE"===e.error.code||"ATHE"===e.error.code||"ATSBR"===e.error.code?void 0!==e.error.meta&&void 0!==e.error.meta.legacy&&e.error.meta.legacy&&refreshUserSessionViaRedirect({context:"userSessionRedirectionLogicHandler",originUrl:o?r:window.location.href,reason:e}):("USLA"===e.error.code||"USMINV"===e.error.code||"RTHE"===e.error.code||0===e.error.code.indexOf("RUS_"))&&restartUserSessionViaRedirect({context:"userSessionRedirectionLogicHandler",originUrl:o?r:window.location.href,reason:e})}},_getUserSessionCookieDebugMeta=function(){var e={error:{code:"1",description:'Failed performing "_getUserSessionCookieDebugMeta"'},data:{}},o=getCookie("userSessionDebugMeta");if(void 0===o||!o)return e.error={code:"USDMCINP",description:"User session debug meta cookie is not present"},e;var r=getCookieValueDecodedStr({str:o});if("0"!==r.error.code)return e.error={code:"DFUSDMC",description:"Failed decoding user session debug meta cookie",meta:{userSessionDebugMetaRawStr:o,userSessionDebugMetaRawStrDecodeRes:r}},e;var t=r.data;if(0!==t.indexOf("{"))return e.error={code:"USDMCINV1",description:"User session debug meta cookie is not valid",meta:{userSessionDebugMetaRawStr:o,userSessionDebugMetaRawJsonStr:t}},e;var s=parseJson({jsonStr:t});return"0"!==s.error.code?e.error={code:"FPUSDMC",description:"Failed parsing user session debug meta cookie",meta:{userSessionDebugMetaRawJsonStr:t,userSessionDebugMetaParseRes:s}}:(e.data=s.data,e.error={code:"0"}),e},_isUserSessionDebugMode=function(){return"true"===getCookie("UserSession.debug")||"true"===localStorage.getItem("UserSession.debug")},setUserSessionCookieDebugMeta=function(e){if(p.logDebug("setUserSessionCookieDebugMeta -> debugMeta: ",e),_isUserSessionDebugMode()){var o=getLocalCurrentUts(),r=o+7776e3,t=new Date(1e3*r),s=_getUserSessionCookieDebugMeta();"0"===s.error.code&&(e.prevDebugMeta=s.data),e.currentUts=o,e.currentDtfs=new Date(1e3*o).toString();var i=getCookieValueEncodedStr({str:JSON.stringify(e)});"0"===i.error.code&&resetCookie({name:"userSessionDebugMeta",value:i.data,maxAge:7776e3,expires:t})}},extractUserInfoCookieData=function(e){var o=void 0===e?{}:e,r=o.userInfoCookie,t=o.skipValidation,s=o.debug,i={error:{code:"1",description:'Failed performing "getUserInfoFromCookiesV2"'},data:{}};if(void 0===r&&(r=getCookie("__c_u_i_1")),void 0===r||!r)return i.error={code:"NOT_FOUND",description:"User info cookie is not set"},i;try{i.data=syncUnpack(r,void 0!==t&&t),i.error={code:"0"}}catch(e){var n=getMetaPreparedFromException(e);i.error={code:"2",description:n.description,meta:{error:n}},void 0!==s&&s&&p.logError("getUserInfoFromCookiesV2 -> exc: ",e)}return i},decodeBase64UrlEncodedJwtSection=function(e){var o={error:{code:"0"},data:""};try{e=e.replace(/-/g,"+").replace(/_/g,"/"),o.data=decodeURIComponent(atob(e).split("").map(function(e){return"%"+("00"+e.charCodeAt(0).toString(16)).slice(-2)}).join(""))}catch(e){o.error=getMetaPreparedFromException(e)}return o};window._tmpUserSessionMimicExpiredAccessToken=function(){if(_isUserSessionDebugMode()){var e=getUserSessionCookieMeta();if("0"===e.error.code){var o=e.data;o.atexp=o.iss,resetCookie({name:"userSessionMeta",value:getCookieValueEncodedStr({str:JSON.stringify(o),mode:1}).data}),changeStatusCodeInUserSessionCookies({newStatusCode:getCookie("userSession")})}}},window._tmpUserSessionMimicExpiredRefreshToken=function(){if(_isUserSessionDebugMode()){var e=getUserSessionCookieMeta();if("0"===e.error.code){var o=e.data;o.atexp=o.iss,o.rtexp=o.iss,resetCookie({name:"userSessionMeta",value:getCookieValueEncodedStr({str:JSON.stringify(o),mode:1}).data}),changeStatusCodeInUserSessionCookies({newStatusCode:getCookie("userSession")})}}};var _tmpDebugUserSession=function(e){try{var _temp19=function(){p.logDebug("UserSessionDebug: ",o)};if(!_isUserSessionDebugMode())return Promise.resolve();var o={statusCode:getCookie("userSession"),meta:getUserSessionCookieMeta(),accessToken:getCookie("accessToken"),accessTokenCookieLifespan:getAccessTokenCookieLifespan(),verificationResult:verifyUserSession({cognitoCfg:getCognitoConfig()}),debugMeta:_getUserSessionCookieDebugMeta()},r=function(){if(void 0!==e&&!0===e)return Promise.resolve(fetchProfileUserSession({method:"POST",data:{method:"DEBUG",userSessionDebug:o},authenticated:!1,attachCookies:!0,refreshTokenOnFailedCognitoAuth:!1})).then(function(){})}();return Promise.resolve(r&&r.then?r.then(_temp19):_temp19(r))}catch(e){return Promise.reject(e)}};window._tmpUserSessionDebug=_tmpDebugUserSession,o.bo=changeStatusCodeInUserSessionCookies,o.Ju=function(){return new Date().getTime()},o.Si=function(e){var o=(void 0===e?{}:e).skipUicValidation,r={error:{code:"1",description:'Failed performing "getUserSessionInfo"'},data:{id:"",email:"",firstName:"",lastName:"",fullName:"",subscriptionPlan:"free",noUpsell:!1,accessToken:"",sessionIsPresent:void 0,sessionVerificationRes:void 0,sessionProcessedUtms:0,isLoggedIn:void 0}},t=verifyUserSession({cognitoCfg:getCognitoConfig(),earlyVerifyAccessToken:!0});r.data.sessionVerificationRes=t,r.data.accessToken=t.data.rawStr,void 0!==t.data.payload&&(r.data.id=t.data.payload.sub),"0"!==t.error.code&&(r.error=t.error);var s=extractUserInfoCookieData({skipValidation:void 0!==o&&o});void 0!==s.data.fname&&(r.data.firstName=s.data.fname,r.data.lastName=s.data.lname,r.data.fullName=(r.data.firstName+" "+r.data.lastName).trim(),r.data.email=s.data.email,r.data.subscriptionPlan=s.data.plan||"free",r.data.noUpsell=s.data.noUpsell||!1),"1"===r.error.code&&"0"!==s.error.code&&(r.error={code:"UIC_"+s.error.code,description:s.error.description,meta:{error:s.error}});var i=t.error.code;return("0"===i||"USSBR"===i||"USHE"===i||"ATHE"===i||"ATSBR"===i)&&(r.data.sessionIsPresent=!0),"1"===r.error.code&&(r.error={code:"0"}),r},o.Sg=function(e){var o=e.context,r=e.originUrl,t=e.reason;p.logDebug("logOutViaRedirect -> context: ",o),p.logDebug("logOutViaRedirect -> originUrl: ",r),setUserSessionCookieDebugMeta({origin:r,context:o,description:"logOutViaRedirect",reason:t,prevStatusCode:getCookie("userSession"),newStatusCode:a.LoggedOut}),changeStatusCodeInUserSessionCookies({newStatusCode:a.LoggedOut});var s=getProfileUrl()+"/log-out";void 0!==r&&r&&(s+="?origin_url="+encodeURIComponent(r)),p.logDebug("logOutViaRedirect -> redirectUrl: ",s),"true"!==localStorage.getItem("skipRedirect")&&(window.location.href=s)},o.Ic=function(e){var o=e.context,r=e.handleRedirectionLogic,t=void 0===r||r,s=e.preferDethrottleCache,i=e.sessionVerificationRes;try{var n,_temp9=function(e){return n?e:(m=a,U=getLocalCurrentUts(),a)};if(p.logDebug("(1) CognitoUtil -> processUserSession -> initialized -> context: ",o),appIsProfile())throw new u({code:"CUSPUSBUOOPA",description:"Common user session processing util should be used outside of profile app"});if((void 0===s||s)&&null!==m&&getLocalCurrentUts()-U<5)return p.logDebug("(-1) CognitoUtil -> processUserSession -> _processUserSessionDethrottleCache: ",m),Promise.resolve(m);var a={error:{code:"FPPUS",description:'Failed processing "processUserSession"'},data:{}},c=function(e,o){try{var r=e()}catch(e){return o(e)}return r&&r.then?r.then(void 0,o):r}(function(){function _temp7(e){if(n)return e;function _temp5(e){a=o,p.logDebug("(10) CognitoUtil -> processUserSession -> output: ",a)}var r=function(){if("0"!==o.error.code)return a.error=o.error,p.logDebug("(E4) CognitoUtil -> processUserSession -> output.error: ",a.error),Promise.resolve(logOut({context:"CUPUS3",skipBackendUserSessionDeletion:!1,skipUserSessionStatusCodeCookieChange:!0,reason:{cookieUserSessionVerificationRes:o}})).then(function(){return m=a,U=getLocalCurrentUts(),t&&userSessionRedirectionLogicHandler(a),n=1,a})}();return r&&r.then?r.then(_temp5):_temp5(r)}var e=getCognitoConfig();p.logDebug("(2) CognitoUtil -> processUserSession -> cognitoCfg: ",e);var o=i||verifyUserSession({cognitoCfg:e});p.logDebug("(3) CognitoUtil -> processUserSession -> verifyUserSession -> cookieUserSessionVerificationRes: ",o);var r=function(){if("USSBR"===o.error.code||"USHE"===o.error.code||"ATHE"===o.error.code||"ATSBR"===o.error.code){var r=void 0!==o.error.meta&&void 0!==o.error.meta.legacy&&o.error.meta.legacy;return p.logDebug("(6.1) CognitoUtil -> processUserSession -> refresh -> legacy: ",r),function(){if(!r)return Promise.resolve(k("CognitoUtil -> processUserSession")).then(function(r){function _temp3(r){return o=verifyUserSession({cognitoCfg:e}),p.logDebug("(7) CognitoUtil -> processUserSession -> verifyUserSession -> cookieUserSessionVerificationRes: ",o),function(){if("0"!==o.error.code)return a.error={code:"RUS_FREFCUS2",description:"Failed refreshing current user sessions",meta:o.error},p.logDebug("(E3.1) CognitoUtil -> processUserSession -> output.error: ",a.error),Promise.resolve(logOut({context:"CUPUS2.1",skipBackendUserSessionDeletion:!1,skipUserSessionStatusCodeCookieChange:!0,reason:{cookieUserSessionVerificationRes:o}})).then(function(){return m=a,U=getLocalCurrentUts(),t&&userSessionRedirectionLogicHandler(a),n=1,a})}()}p.logDebug("(6.2) CognitoUtil -> processUserSession -> refreshUserSessionRes: ",r);var s=function(){if("0"!==r.error.code)return a.error={code:"RUS_FREFCUS1",description:"Failed refreshing current user sessions",meta:r.error},p.logDebug("(E2) CognitoUtil -> processUserSession -> output.error: ",a.error),Promise.resolve(logOut({context:"CUPUS1",skipBackendUserSessionDeletion:!1,skipUserSessionStatusCodeCookieChange:!0,reason:{refreshUserSessionRes:r}})).then(function(){return m=a,U=getLocalCurrentUts(),t&&userSessionRedirectionLogicHandler(a),n=1,a})}();return s&&s.then?s.then(_temp3):_temp3(s)})}()}}();return r&&r.then?r.then(_temp7):_temp7(r)},function(e){return p.logDebug("(E1) CognitoUtil -> processUserSession -> exc: "),p.logDebug(e),a.error.meta=getMetaPreparedFromException(e),Promise.resolve(logOut({context:"CUPUS5",skipBackendUserSessionDeletion:!1,skipUserSessionStatusCodeCookieChange:!0,reason:{output:a}})).then(function(){})});return Promise.resolve(c&&c.then?c.then(_temp9):_temp9(c))}catch(e){return Promise.reject(e)}},o.jY=function(e){return p.logDebug("setDefaultFetchConfig -> cfg: ",e),Object.keys(e).forEach(function(o){h[o]=e[o]}),h}},83838:function(e,o,r){"use strict";r.d(o,{H:function(){return logError},PW:function(){return s},o7:function(){return logDebug}});let currentLogLevel=()=>{{let e=localStorage.getItem("logLevel");switch(null==e&&(e=localStorage.getItem("level")),e){case"info":return 20;case"debug":return 10}}return 40},t={},logDebug=function(e){for(var o=arguments.length,r=Array(o>1?o-1:0),t=1;t<o;t++)r[t-1]=arguments[t];10>=currentLogLevel()&&console.log(e,r)},logError=function(e){for(var o=arguments.length,r=Array(o>1?o-1:0),t=1;t<o;t++)r[t-1]=arguments[t];console.error(e,r)},s={logError:logError,logDebug:logDebug,logInfo:function(e){for(var o=arguments.length,r=Array(o>1?o-1:0),t=1;t<o;t++)r[t-1]=arguments[t];20>=currentLogLevel()&&console.log(e,r)},logAll:function(e){for(var o=arguments.length,r=Array(o>1?o-1:0),t=1;t<o;t++)r[t-1]=arguments[t];40>=currentLogLevel()&&console.log(e,r)},log:(e,o)=>{currentLogLevel()<=o&&console.log(e)}}}}]);